{#{% extends 'base.html.twig' %}#}
{% extends '@!EasyAdmin/layout.html.twig' %}

{% block title %}Edit Post{% endblock %}

{% block body %}
    <h1>Edit Post</h1>

    {{ include('post/_form.html.twig', {'button_label': 'Update'}) }}

    <a href="{{ path('app_post_index') }}">back to list</a>

    {{ include('post/_delete_form.html.twig') }}
{% endblock %}

{% block javascripts %}
{#    <scrip src="{{ asset('js/photos.js') }}"></scrip>#}
    <script>
        window.onload = () => {
    // Gestion des boutons "supprimer"
    let links = document.querySelectorAll("[data-delete]")

    // On boucle
            for (const link of links) {
                // On écoute le clic
                link.addEventListener("click", function (e) {
                    // Désactiver le lien
                    e.preventDefault()

                    // On demande confirmation
                    if (confirm("Veux-tu vraiment supprimer cette photo ?")){
                        // On envoie une requête Ajax vers le href du lien avec la méthode DELETE
                        fetch(this.getAttribute("href"),{
                            method:  "DELETE",
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({"_token": this.dataset.token})
                        }).then(
                            // On récupère la réponse en JSON
                            response => response.json()
                        ).then(data => {
                            if (data.success)
                                this.parentElement.remove()
                            else
                                alert(data.error)
                        })
                    }
                    
                })
            }        
}

    </script>
{% endblock %}
